#!/bin/bash
set -e

echo "ğŸ—„ï¸  Initialisation de la base de donnÃ©es Railway - SIMPLE"
echo "=========================================================="
echo ""

echo "ğŸ“ Ã‰tape 1: Connexion Ã  PostgreSQL pour crÃ©er un admin"
echo ""
echo "Je vais ouvrir le shell PostgreSQL Railway."
echo "Une fois connectÃ©, exÃ©cutez CES COMMANDES SQL :"
echo ""
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo ""
echo "-- 1. VÃ©rifier que les tables existent (doit retourner des lignes)"
echo "SELECT tablename FROM pg_tables WHERE schemaname = 'public' LIMIT 5;"
echo ""
echo "-- Si pas de tables, la DB n'est pas migrÃ©e. Dans ce cas:"
echo "-- Fermez ce shell et dites-moi, on fera les migrations d'abord"
echo ""
echo "-- 2. Si les tables existent, rÃ©cupÃ©rer la clÃ© publique:"
echo "SELECT token FROM api_key WHERE type = 'publishable';"
echo ""
echo "-- 3. Copiez la clÃ© pk_..."
echo ""
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo ""
read -p "Appuyez sur ENTRÃ‰E pour ouvrir le shell PostgreSQL..."

railway connect postgres

echo ""
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘    ğŸ“ APRÃˆS RÃ‰CUPÃ‰RATION DE LA CLÃ‰           â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "Allez sur Railway â†’ Storefront â†’ Variables"
echo "Mettez: NEXT_PUBLIC_MEDUSA_PUBLISHABLE_KEY = pk_..."
echo ""
echo "Si les tables n'existaient PAS, dites-le moi!"
echo ""
