# ğŸš€ Guide de Synchronisation Railway Template B2B

## âœ… Ce qui a Ã©tÃ© fait

1. **RÃ©cupÃ©ration du template Railway optimisÃ©**
   - Template: `rpuls/medusa-b2b-for-railway`
   - Branche crÃ©Ã©e: `railway-sync` (basÃ©e sur le template)

2. **Changements clÃ©s du template Railway**
   - âœ… Admin Medusa activÃ© automatiquement
   - âœ… MinIO pour le stockage de fichiers
   - âœ… Endpoint `/api/key-exchange` pour partage auto de la clÃ© API
   - âœ… Script `postBuild.js` pour initialisation
   - âœ… Redis configurÃ© correctement
   - âœ… Suppression des endpoints custom problÃ©matiques

## ğŸ“‹ Actions Ã  Faire Maintenant

### 1. Connecter Railway CLI au Projet (MANUEL)

```bash
cd "/Users/hichamrouabhi/CascadeProjects/show room pro/b2b-starter-medusa"
railway link
```

Puis sÃ©lectionnez **srpB2B** dans la liste interactive.

### 2. Pousser le Code Propre vers Railway

```bash
# Fusionner la branche railway-sync vers main
git checkout main
git merge railway-sync --strategy-option theirs

# Pousser vers votre repo Railway
git push b2b main --force
```

### 3. VÃ©rifier les Variables d'Environnement Railway

**Backend Service:**
```bash
DATABASE_URL=<auto-generated par Railway>
REDIS_URL=<auto-generated par Railway>
JWT_SECRET=supersecret
COOKIE_SECRET=supersecret
STORE_CORS=<URL_STOREFRONT>
ADMIN_CORS=<URL_BACKEND>
AUTH_CORS=<URL_BACKEND>

# MinIO (auto-configurÃ© par Railway)
MINIO_ENDPOINT=<auto-generated>
MINIO_ACCESS_KEY=<auto-generated>
MINIO_SECRET_KEY=<auto-generated>
MINIO_BUCKET=medusa-media
```

**Storefront Service:**
```bash
NEXT_PUBLIC_MEDUSA_BACKEND_URL=<URL_BACKEND>
NEXT_PUBLIC_MEDUSA_PUBLISHABLE_KEY=<sera rÃ©cupÃ©rÃ© auto via /api/key-exchange>
NEXT_PUBLIC_BASE_URL=<URL_STOREFRONT>
NEXT_PUBLIC_DEFAULT_REGION=us
REVALIDATE_SECRET=supersecret
```

### 4. Premier DÃ©ploiement

AprÃ¨s le push, Railway va automatiquement:
1. **Builder le backend** avec l'admin inclus
2. **ExÃ©cuter les migrations** DB
3. **CrÃ©er un admin user** automatiquement
4. **Seeder les donnÃ©es** de dÃ©mo
5. **Partager la clÃ© API** avec le storefront via `/api/key-exchange`

### 5. AccÃ¨s Admin

Une fois dÃ©ployÃ©:
- **URL Admin**: `https://<backend-url>/app`
- **Credentials** (auto-gÃ©nÃ©rÃ©s): VÃ©rifier les logs Railway pour les identifiants

### 6. Test Storefront

- **URL Storefront**: `https://<storefront-url>`
- Le storefront rÃ©cupÃ¨re automatiquement la publishable key

## ğŸ”§ Commandes Utiles

### VÃ©rifier le status Railway
```bash
railway status
```

### Voir les logs en temps rÃ©el
```bash
railway logs -f
```

### Lister les services du projet
```bash
railway service list
```

### Variables d'environnement
```bash
railway variables
```

## ğŸ“Š Architecture Railway Template

```
srpB2B (Project)
â”œâ”€â”€ Backend (Service)
â”‚   â”œâ”€â”€ PostgreSQL (Database - auto)
â”‚   â”œâ”€â”€ Redis (Cache - auto)
â”‚   â”œâ”€â”€ MinIO (Storage - auto)
â”‚   â””â”€â”€ Medusa API + Admin
â””â”€â”€ Storefront (Service)
    â””â”€â”€ Next.js App
```

## âš ï¸ DiffÃ©rences avec l'ancien setup

| Ancien | Nouveau (Template Railway) |
|--------|----------------------------|
| Admin dÃ©sactivÃ© | âœ… Admin activÃ© |
| Endpoints custom seed | âœ… Seed automatique au dÃ©marrage |
| Configuration manuelle Redis | âœ… Redis auto-configurÃ© |
| Pas de stockage fichiers | âœ… MinIO intÃ©grÃ© |
| ClÃ© API manuelle | âœ… `/api/key-exchange` auto |

## ğŸ¯ Prochaines Ã‰tapes AprÃ¨s DÃ©ploiement

1. âœ… VÃ©rifier que l'admin est accessible
2. âœ… CrÃ©er produits/catÃ©gories via l'admin
3. âœ… Tester le storefront
4. âœ… Configurer les emails (optionnel)
5. âœ… Configurer les paiements (optionnel)

## ğŸ†˜ En cas de problÃ¨me

### Le build Ã©choue
```bash
# VÃ©rifier les logs
railway logs -f

# Forcer un rebuild
railway up --detach
```

### L'admin ne dÃ©marre pas
VÃ©rifier que `ADMIN_CORS` et `AUTH_CORS` incluent l'URL du backend

### Le storefront ne rÃ©cupÃ¨re pas la clÃ©
VÃ©rifier que `/api/key-exchange` retourne la clÃ© via:
```bash
curl https://<backend-url>/api/key-exchange
```

## ğŸ“š Documentation Template

- **GitHub**: https://github.com/rpuls/medusa-b2b-for-railway
- **Medusa Docs**: https://docs.medusajs.com/v2
- **Railway Docs**: https://docs.railway.app

---

**Date**: 23 Octobre 2025  
**Template Version**: rpuls/medusa-b2b-for-railway (main)  
**Medusa Version**: 2.8.4
