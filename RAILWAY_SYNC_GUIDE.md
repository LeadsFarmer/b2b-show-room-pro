# 🚀 Guide de Synchronisation Railway Template B2B

## ✅ Ce qui a été fait

1. **Récupération du template Railway optimisé**
   - Template: `rpuls/medusa-b2b-for-railway`
   - Branche créée: `railway-sync` (basée sur le template)

2. **Changements clés du template Railway**
   - ✅ Admin Medusa activé automatiquement
   - ✅ MinIO pour le stockage de fichiers
   - ✅ Endpoint `/api/key-exchange` pour partage auto de la clé API
   - ✅ Script `postBuild.js` pour initialisation
   - ✅ Redis configuré correctement
   - ✅ Suppression des endpoints custom problématiques

## 📋 Actions à Faire Maintenant

### 1. Connecter Railway CLI au Projet (MANUEL)

```bash
cd "/Users/hichamrouabhi/CascadeProjects/show room pro/b2b-starter-medusa"
railway link
```

Puis sélectionnez **srpB2B** dans la liste interactive.

### 2. Pousser le Code Propre vers Railway

```bash
# Fusionner la branche railway-sync vers main
git checkout main
git merge railway-sync --strategy-option theirs

# Pousser vers votre repo Railway
git push b2b main --force
```

### 3. Vérifier les Variables d'Environnement Railway

**Backend Service:**
```bash
DATABASE_URL=<auto-generated par Railway>
REDIS_URL=<auto-generated par Railway>
JWT_SECRET=supersecret
COOKIE_SECRET=supersecret
STORE_CORS=<URL_STOREFRONT>
ADMIN_CORS=<URL_BACKEND>
AUTH_CORS=<URL_BACKEND>

# MinIO (auto-configuré par Railway)
MINIO_ENDPOINT=<auto-generated>
MINIO_ACCESS_KEY=<auto-generated>
MINIO_SECRET_KEY=<auto-generated>
MINIO_BUCKET=medusa-media
```

**Storefront Service:**
```bash
NEXT_PUBLIC_MEDUSA_BACKEND_URL=<URL_BACKEND>
NEXT_PUBLIC_MEDUSA_PUBLISHABLE_KEY=<sera récupéré auto via /api/key-exchange>
NEXT_PUBLIC_BASE_URL=<URL_STOREFRONT>
NEXT_PUBLIC_DEFAULT_REGION=us
REVALIDATE_SECRET=supersecret
```

### 4. Premier Déploiement

Après le push, Railway va automatiquement:
1. **Builder le backend** avec l'admin inclus
2. **Exécuter les migrations** DB
3. **Créer un admin user** automatiquement
4. **Seeder les données** de démo
5. **Partager la clé API** avec le storefront via `/api/key-exchange`

### 5. Accès Admin

Une fois déployé:
- **URL Admin**: `https://<backend-url>/app`
- **Credentials** (auto-générés): Vérifier les logs Railway pour les identifiants

### 6. Test Storefront

- **URL Storefront**: `https://<storefront-url>`
- Le storefront récupère automatiquement la publishable key

## 🔧 Commandes Utiles

### Vérifier le status Railway
```bash
railway status
```

### Voir les logs en temps réel
```bash
railway logs -f
```

### Lister les services du projet
```bash
railway service list
```

### Variables d'environnement
```bash
railway variables
```

## 📊 Architecture Railway Template

```
srpB2B (Project)
├── Backend (Service)
│   ├── PostgreSQL (Database - auto)
│   ├── Redis (Cache - auto)
│   ├── MinIO (Storage - auto)
│   └── Medusa API + Admin
└── Storefront (Service)
    └── Next.js App
```

## ⚠️ Différences avec l'ancien setup

| Ancien | Nouveau (Template Railway) |
|--------|----------------------------|
| Admin désactivé | ✅ Admin activé |
| Endpoints custom seed | ✅ Seed automatique au démarrage |
| Configuration manuelle Redis | ✅ Redis auto-configuré |
| Pas de stockage fichiers | ✅ MinIO intégré |
| Clé API manuelle | ✅ `/api/key-exchange` auto |

## 🎯 Prochaines Étapes Après Déploiement

1. ✅ Vérifier que l'admin est accessible
2. ✅ Créer produits/catégories via l'admin
3. ✅ Tester le storefront
4. ✅ Configurer les emails (optionnel)
5. ✅ Configurer les paiements (optionnel)

## 🆘 En cas de problème

### Le build échoue
```bash
# Vérifier les logs
railway logs -f

# Forcer un rebuild
railway up --detach
```

### L'admin ne démarre pas
Vérifier que `ADMIN_CORS` et `AUTH_CORS` incluent l'URL du backend

### Le storefront ne récupère pas la clé
Vérifier que `/api/key-exchange` retourne la clé via:
```bash
curl https://<backend-url>/api/key-exchange
```

## 📚 Documentation Template

- **GitHub**: https://github.com/rpuls/medusa-b2b-for-railway
- **Medusa Docs**: https://docs.medusajs.com/v2
- **Railway Docs**: https://docs.railway.app

---

**Date**: 23 Octobre 2025  
**Template Version**: rpuls/medusa-b2b-for-railway (main)  
**Medusa Version**: 2.8.4
